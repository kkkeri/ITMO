<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>BookCreatures</title>
    <link rel="stylesheet" href="css/styles.css">
    <script defer src="js/creatures.js?v=2"></script>
</head>
<body>

<header>
    <h1>Существа (BookCreature)</h1>
</header>
<div class="user-context">
    <label>
        Пользователь:
        <input id="userNameInput" value="student">
    </label>

    <label>
        Роль:
        <select id="userRoleSelect">
            <option value="USER">USER</option>
            <option value="ADMIN">ADMIN</option>
        </select>
    </label>

    <button id="applyUserContextBtn" type="button">Применить</button>
</div>
<main>
    <!-- фильтр по нескольким строковым полям -->
    <div class="filter-block">
        <label for="nameFilter">Имя:</label>
        <input id="nameFilter" type="text" placeholder="часть имени">

        <label for="typeFilter">Тип:</label>
        <select id="typeFilter">
            <option value="">(любой)</option>
            <option value="HOBBIT">HOBBIT</option>
            <option value="ELF">ELF</option>
            <option value="HUMAN">HUMAN</option>
            <option value="GOLLUM">GOLLUM</option>
        </select>
    </div>

    <div class="filter-block">
        <label for="ringFilter">Имя кольца:</label>
        <input id="ringFilter" type="text" placeholder="часть имени кольца">

        <button onclick="applyCreatureFilters()">Применить</button>
        <button onclick="resetCreatureFilters()">Сбросить</button>
    </div>

    <!-- кнопка создания нового существа -->
    <div style="margin-top: 10px;">
        <button class="primary" onclick="startCreate()">Создать новое существо</button>
    </div>

    <!-- ====== ИМПОРТ JSON (ЛР2) ====== -->
    <div class="filter-block" style="margin-top: 14px;">
        <label style="min-width: 0;">Импорт существ (JSON):</label>
        <input type="file" id="creaturesImportFile" accept=".json">
        <button class="primary" type="button" onclick="importCreatures()">Импорт</button>
    </div>
    <div id="creaturesImportResult" class="error" style="display:none; margin-top: 8px;"></div>
    <!-- ====== /ИМПОРТ JSON ====== -->

    <!-- таблица существ -->
    <table>
        <thead>
        <tr>
            <th class="sortable" onclick="sortCreaturesBy('id')">ID</th>
            <th class="sortable" onclick="sortCreaturesBy('name')">Имя</th>
            <th class="sortable" onclick="sortCreaturesBy('age')">Возраст</th>
            <th>Коорд. X</th>
            <th>Коорд. Y</th>
            <th class="sortable" onclick="sortCreaturesBy('creatureType')">Тип</th>
            <th class="sortable" onclick="sortCreaturesBy('attackLevel')">Уровень атаки</th>
            <th class="sortable" onclick="sortCreaturesBy('city')">Город</th>
            <th class="sortable" onclick="sortCreaturesBy('ring')">Кольцо</th>
            <th class="sortable" onclick="sortCreaturesBy('creationDate')">Дата создания</th>
            <th>Действия</th>
        </tr>
        </thead>
        <tbody id="creaturesTableBody">
        </tbody>
    </table>

    <!-- пагинация -->
    <div class="pagination">
        <button id="prevPage">Назад</button>
        <span id="pageInfo">Страница 1 из 1</span>
        <button id="nextPage">Вперёд</button>

        <label style="margin-left: 15px;">
            Показать:
            <select id="pageSizeSelect">
                <option value="5">5</option>
                <option value="10" selected>10</option>
                <option value="20">20</option>
            </select>
            записей
        </label>
    </div>

    <section style="margin-top: 18px;">
        <h2>История импорта</h2>

        <button onclick="loadImportHistory()">Обновить</button>

        <table style="margin-top: 10px;">
            <thead>
            <tr>
                <th>ID</th>
                <th>Статус</th>
                <th>Пользователь</th>
                <th>Добавлено</th>
                <th>Ошибка</th>
            </tr>
            </thead>
            <tbody id="importHistoryBody"></tbody>
        </table>

        <div id="importHistoryError" class="error" style="display:none;"></div>
    </section>

    <!-- форма создания / редактирования -->
    <!-- модальное окно создания / редактирования существа -->
    <div id="editSection" class="modal-overlay" style="display: none;">

        <div class="modal-window">
            <h2 id="editTitle">Новое существо</h2>

            <div class="form-row">
                <label for="creatureName">Имя:</label>
                <input id="creatureName" type="text" maxlength="80">
            </div>

            <div class="form-row">
                <label for="creatureAge">Возраст:</label>
                <input id="creatureAge" type="number" min="1">
            </div>

            <div class="form-row">
                <label for="creatureType">Тип существа:</label>
                <select id="creatureType">
                    <option value="HOBBIT">HOBBIT</option>
                    <option value="ELF">ELF</option>
                    <option value="HUMAN">HUMAN</option>
                    <option value="GOLLUM">GOLLUM</option>
                </select>
            </div>

            <div class="form-row">
                <label for="attackLevel">Уровень атаки:</label>
                <input id="attackLevel" type="number" step="0.1" min="0.1">
            </div>

            <div class="form-row">
                <label for="coordX">Коорд. X:</label>
                <input id="coordX" type="number" step="0.01">
            </div>

            <div class="form-row">
                <label for="coordY">Коорд. Y:</label>
                <input id="coordY" type="number" step="0.01">
            </div>

            <div class="form-row">
                <label for="cityId">ID города (может быть пусто):</label>
                <input id="cityId" type="number" min="1">
            </div>

            <div class="form-row">
                <label for="ringName">Имя кольца (может быть пусто):</label>
                <input id="ringName" type="text" maxlength="80">
            </div>

            <div class="form-row">
                <label for="ringPower">Сила кольца (может быть пусто):</label>
                <input id="ringPower" type="number" min="1">
            </div>

            <div style="margin-top: 12px; text-align: right;">
                <button class="primary" onclick="saveCreature()">Сохранить</button>
                <button onclick="cancelEdit()">Отмена</button>
            </div>

            <div id="formError" class="error" style="display: none;"></div>
        </div>

    </div>

    <div id="globalError" class="error" style="display: none;"></div>
</main>

</body>
</html>